const cricket = [
    //Cricket
    [
        1000,
        "Virat Kohli Signed Bat",
        5000.00,
        "./img/VK1.jpg",
        "Cricket"
    ],
    [
        1001,
        "2015 Indian WC team signed bat",
        2500.00,
        "./img/C2.jpg",
        "Cricket"
    ],
    [
        1002,
        "MS Dhoni Signed Jersey",
        4000.00,
        "./img/MSD1.jpg",
        "Cricket"
    ],
    [
        1003,
        "MS Dhoni Signed Ball",
        2750.00,
        "./img/MSD2.jpg",
        "Cricket"
    ],
    [
        1004,
        "Ab De Villiers signed Bat",
        3500.00,
        "./img/ABD1.jpg",
        "Cricket"
    ],
    [
        1005,
        "Chris Gayel Signed bat",
        3200.00,
        "./img/Gayel1.jpg",
        "Cricket"
    ],
    [
        1006,
        "David Warner Signed bat",
        3750.00,
        "./img/DW1.jpg",
        "Cricket"
    ],
    [
        1007,
        "Sachin Tendulkar Signed bat",
        5500.00,
        "./img/ST1.jpg",
        "Cricket"
    ],
    [
        1008,
        "Kumara Sangakara Signed bat",
        3500.00,
        "./img/SK1.jpg",
        "Cricket"
    ]
]

const football = [
    [
        1009,
        "Cristiano Ronaldo Signed Ball",
        6000.00,
        "./img/CR1.jpg",
        "Football"
    ],
    [
        1010,
        "Cristiano Ronaldo Signed Jersey",
        5500.00,
        "./img/CR2.jpg",
        "Football"
    ],
    [
        1011,
        "Cristiano Ronaldo Signed Shoes",
        5700.00,
        "./img/CR3.jpg",
        "Football"
    ],
    [
        1012,
        "Neymar JR Signed Jersey",
        5300.00,
        "./img/Nm1.jpg",
        "Football"
    ],
    [
        1013,
        "Messi Signed Jersey",
        5900.00,
        "./img/M11.jpg",
        "Football"
    ],
    [
        1014,
        "Sunil Chhetri Signed Jersey",
        1900.00,       
        "https://m.media-amazon.com/images/I/71GL4okP1nL._SX679_.jpg",
        "Football",
    ],
    [
        1015,
        "Real Madrid Jersey Signed by Luka Modric",
        2700.00,       
        "https://cdn.shopify.com/s/files/1/0027/0480/1852/products/modric-signed-shirt-front-ballon-dor-winnder_480x480.jpg?v=1590587829",
        "Football",
    ],
    [
        1016,
        "Belgium Jersey Signed by Eden Hazard",
        2200.00,       
        "https://static1.cdn-subsidesports.com/2/media/catalog/product/cache/38d4094f49a5c2931b615f53f1250097/a/2/a2c9a8e33ec915a4eed815298e89eb533e5fdb017507613ae6f4327ee9765f0b.jpeg",
        "Football",
    ],
    [
        1017,
        "Gigi Buffon Signed Italia Jersey",
        2000.00,       
        "https://media.karousell.com/media/photos/products/2020/5/2/gigi_buffon_signed_italy_jerse_1588385800_dfb0fed4_progressive.jpg",
        "Football",
    ]
]

const basketball = [

    //Basketball
    [
        1018,
        "Lebron James Jersey Lakers",
        1000.00,
        "https://static.nike.com/a/images/t_PDP_1728_v1/f_auto,b_rgb:f5f5f5/e822abf3-dad2-4636-b5a8-3d40408d213e/los-angeles-lakers-nba-t-shirt-SvGGrF.png",
        "Basketball"
    ],
    [
        1019,
        "Lebron James and DwyaneWade Dual Signed Basketball",
        4000.00,       
        "https://upperdeckstore.com/media/catalog/product/cache/cca31960a2955b031df57569d9e7c7f0/l/e/lebron-james-dwyane-wade-dual-signed-basketball-77602_9_1.jpg",
        "Basketball",
    ],
    [
        1020,
        "BYUBasketBall Team Signed Basketball",
        6000.00,       
        "https://res.cloudinary.com/bidr/image/upload/d_eg_placeholder_xhn1xm.png/v1607540868/78312/u69xyqoeh3buarpvkt0l.jpg",
        "Basketball",
    ],
    [
        1021,
        "Wilson NBA DRV Series Basketball",
        2500.00,       
        "https://18cfdfd73150f69310ab-4d842a0601d0ae955a714605e7fb6d6f.ssl.cf2.rackcdn.com/15254/14201447.jpg",
        "Basketball",
    ],
    [
        1022,
        "Micheal Jordan Basketball Jersey",
        1500.00,       
        "https://image.cnbcfm.com/api/v1/image/107119872-1663332942674-gettyimages-1421354555-ajr_9259_42a9560c-78e3-4e8a-aef1-7d0c6512333f.jpeg?v=1663335676&w=740&h=416&ffmt=webp",
        "Basketball",
    ],
    [
        1023,
        "Magic Johnson Jersey Lakers",
        2000.00,      
        "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRjOkZrJ4IU7smZoKxH5ri-4jrle7wGaTDf8w&usqp=CAU",
        "Basketball",
    ],
    [
        1024,
        "Wilt Chamberlain Jersey Lakers",
        2500.00,      
        "https://static.mitchellandness.com/media/catalog/product/cache/faecf306f19cfddfc0fac775879e801e/a/j/ajy4cp19159-p76roya66wcm_1.jpg",
        "Basketball",
    ],
    [
        1025,
        "Oscar Robertson Jersey",
        3000.00,      
        "https://www.dhresource.com/0x0/f2/albu/g6/M01/B3/A4/rBVaSFrhJHiAFQASAAG3TCf1G78885.jpg",
        "Basketball",
    ],
    [
        1026,
        "Lary Bird Jersey",
        3000.00,      
        "https://images-na.ssl-images-amazon.com/images/I/71xA5f2sTaL.jpg",
        "Basketball",
    ],
]


const tennis = [
    [
        1027,
        "Roger Federer Signed Racquet",
        2000.00,
        "https://s3.amazonaws.com/charitycdn/cache/resizedcrop-7c85315f56c823f6e829474ac2191000-840x480.jpg",
        "Lawn Tennis",
    ],
    [
        1028,
        "Serena Williams Signed Poster",
        1700.00,
        "https://images.fineartamerica.com/images/artworkimages/mediumlarge/3/1-serena-wiliams-kylie-pehotko.jpg",
        "Lawn Tennis",
    ],
    [
        1029,
        "Roger Federer Signed Poster",
        1500.00,
        "https://images.fineartamerica.com/images/artworkimages/mediumlarge/2/roger-federer-amaranta-marin.jpg",
        "Lawn Tennis",
    ],
    [
        1030,
        "Rafael Nadal Signed Poster",
        2300.00,       
        "https://muscleglass.files.wordpress.com/2012/10/nadal-1.jpg",
        "Lawn Tennis",
    ],
    [
        1031,
        "Rafael Nadal Signed Shirt",
        2300.00,       
        "https://elite-exclusives.co.uk/wp-content/uploads/2021/10/Nadal-blue-shirt-1_1.jpg",
        "Lawn Tennis",
    ],
    [
        1032,
        "Rafael Nadal Signed Spain Jersey",
        5000.00,       
        "https://d2mpxrrcad19ou.cloudfront.net/item_images/1096221/11428004_bukobject.jpg",
        "Lawn Tennis",
    ],
    [
        1033,
        "Roger Federer Signed Racquet 2011 French Open",
        3000.00,       
        "https://m.media-amazon.com/images/I/710ejZpB2VL._SY450_.jpg",
        "Lawn Tennis",
    ],
    [
        1034,
        "Serena Williams Signed Racquet",
        3000.00,       
        "http://natedsanders.com/ItemImages/000056/Serena%20Williams%20Wimbledon%202005%20Match%20Used%20Broken%20and%20Signed%20Tennis%20Racket%2059023c_lg.jpeg",
        "Lawn Tennis",
    ],
    [
        1035,
        "Nick Kyrgios Signed Racquet",
        3000.00,       
        "https://s3.amazonaws.com/charitycdn/cache/resizedcrop-34a6192d97bd09d19789a44b700783f9-840x480.jpg",
        "Lawn Tennis",
    ],
]


/*const notify = message => {
    const dialogBox = document.createElement('div')
    dialogBox.className = "modal fade"
    dialogBox.id = "exampleModal"
    dialogBox.tabIndex = "-1"
    dialogBox.setAttribute("role", "dialog")
    dialogBox.setAttribute("aria-hidden", "true")
    dialogBox.setAttribute("aria-labelledby", "exampleModalLabel")

    dialogBox.innerHTML = `
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Alert</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    ${message}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    `
    document.body.insertBefore(dialogBox, null)

    const dialogButton = document.createElement('button')
    dialogButton.type = "button"
    dialogButton.className = "btn btn-primary"
    dialogButton.setAttribute("data-toggle", "modal")
    dialogButton.setAttribute("data-target", "#exampleModal")
    

    document.body.insertBefore(dialogButton, null)
    dialogButton.click()
}*/


const loadProducts = (productsArray, size = "col-xl-4 col-lg-6") => {
    let domString = ""
    for(let product of productsArray) {
        domString += `
            <div class="${size}">
                <div class="blog-item bg-primary">
                    <img style="object-fit: cover; height: 350px;" class="img-fluid w-100" src="${product[3]}" alt="${product[1]}">
                    <div class="d-flex align-items-center">
                        <div class="bg-secondary mt-n4 d-flex flex-column flex-shrink-0 justify-content-center text-center me-4" style="width: 60px; height: 100px;">
                            <i class="fa fa-calendar-alt text-primary mb-2"></i>
                            <p class="m-0 text-white">${
                                "Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[(Math.round(Math.random()*11))]
                            } ${Math.round(Math.random()*27) + 1}</p>
                            <small class="text-white">2023</small>
                        </div>
                        <a class="h4 m-0 text-truncate me-4" >${product[1]}</a>
                    </div>
                    <div class="d-flex justify-content-between border-top border-secondary p-4">
                        <div class="d-flex align-items-center">
                            <small class="text-uppercase">Product Id : ${product[0]}</small>
                        </div>
                        <div class="d-flex align-items-center">
                            <a href="product.html?id=${product[0]}" class="btn btn-secondary rounded-pill py-2 px-4 mx-2">Bid now</a>
                        </div>
                    </div>
                </div>
            </div>
        `
    }
    document.getElementById("products").innerHTML = domString
}


const getCurrentBid = productId => {
    return new Promise((resolve, reject) => {
        fetch(`https://bhavyakukkar.000webhostapp.com/sportybidwarz/server/actions/currentBid.php?id=${productId}`)
            .then(res => res.text())
            .then(text => {
                const response = new DOMParser().parseFromString(text, "text/html");
                const username = response.getElementById("username")?.innerHTML;
                const amount = response.getElementById("amount")?.innerHTML;
                const time = response.getElementById("time")?.innerHTML;
                
                resolve({username, amount, time})
            })
    })
}


const setNewBid = (productId, username, amount) => {
    return new Promise((resolve, reject) => {
        fetch(`https://bhavyakukkar.000webhostapp.com/sportybidwarz/server/actions/bidNow.php?item=${productId}&id=${username}&amt=${amount}`)
            .then(res => res.text())
            .then(text => resolve())
    })
}


const loadSingleProduct = (productId, username, amount, time) => {
    const product = [...cricket, ...football, ...basketball, ...tennis].find(product => product[0] === productId)
    
    document.querySelector("#product").innerHTML = `
        <div class="row d-flex justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="images p-3">
                                <div class="text-center p-4"> <img id="main-image" src="${product[3]}" width="350" /> </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="product p-4">
                                <div class="mt-4 mb-3">
                                    <h3 class="text-uppercase">${product[1]}</h3>
                                    <div class="price d-flex flex-row align-items-center"> <span class="act-price">$${product[2]}</span></div>
                                </div>
                                <div class="sizes mt-5 mb-5">
                                    <h5 class="text-uppercase">Current Bid</h5>
                                    ${
                                        username !== "" ?
                                            `
                                                <div class="d-flex">
                                                    <p class="fw-bold text-info me-5">@${username}</p>
                                                    <p class="text-dark">$${amount}</p>
                                                </div>
                                                <i class="fa fa-clock text-muted"></i><span class="ms-1" style="font-size: 14px;">${(new Date(time.replace(/-/g,"/"))).toString().split("GMT")[0]}</span>
                                            ` : `
                                                <p class="fw-bold text-secondary">No Bids Yet</p>
                                            `
                                    }
                                </div>
                                <div class="cart mt-4 align-items-center">
                                    <h5 class="text-uppercase">Your Bid</h5>
                                    <div class="d-flex align-items-end">
                                        <div class="d-flex flex-column me-2">
                                            <label class="form-label mb-1" style="font-size: 14px;">Username:</label>
                                            <input id="usernameInput" class="w-100 form-control border border-2" type="text">
                                        </div>
                                        <div class="d-flex flex-column me-3">
                                            <label class="form-label mb-1" style="font-size: 14px;">Amount:</label>
                                            <input id="amountInput" class="w-100 form-control border border-2" type="number">
                                        </div>
                                        <button id="bidNowButton" class="btn btn-danger text-uppercase mr-2 px-4">Bid Now</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `

    document.querySelector("#usernameInput").addEventListener('change', e => {
        e.target.value !== "" ?
            e.target.className = "w-100 form-control border border-2 border-success" :
            e.target.className = "w-100 form-control border border-2"
    })

    document.querySelector("#amountInput").addEventListener('change', e => {
        if( (username !== "" && parseInt(e.target.value) > amount) || (username === "" && parseInt(e.target.value) > product[2]) ) {
            e.target.className = "w-100 form-control border border-2 border-success"
            document.querySelector("#bidNowButton").className = "btn btn-danger text-uppercase mr-2 px-4"
        }
        else {
            e.target.className = "w-100 form-control border border-2 border-danger"
            document.querySelector("#bidNowButton").className = "btn btn-danger text-uppercase mr-2 px-4 disabled"
        }
    })

    document.querySelector("#bidNowButton").addEventListener('click', () => {
        setNewBid(
            productId,
            document.querySelector("#usernameInput").value,
            document.querySelector("#amountInput").value
        ).then(() => window.location.reload())
    })
}

switch(document.querySelector("#heading").innerText.split(" ")[0]) {
    case "Cricket":
        loadProducts(cricket)
        break

    case "Football":
        loadProducts(football)
        break

    case "Basketball":
        loadProducts(basketball)
        break

    case "Tennis":
        loadProducts(tennis)
        break
    
    case "Online":
        loadProducts([cricket[0], football[3], basketball[5], tennis[8]], "col-12 col-lg-3")
        break
    
    default:
        const productId = parseInt(window.location.href.slice(-4))
        getCurrentBid(productId)
            .then(({username, amount, time}) => loadSingleProduct(productId, username, amount, time))
        break
}